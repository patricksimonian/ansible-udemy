---
  - hosts: loadbalancer
    become: true
    tasks:
      - name: stop loadbalancer
        service: name=nginx state=stopped
  
  - hosts: webserver
    become: true
    tasks:
      - name: stop webserver
        service: name=apache2 state=stopped

  - hosts: database
    become: true
    tasks:
      - name: restart database
        service: name=mysql state=restarted

  - hosts: loadbalancer
    become: true
    tasks:
      - name: start loadbalancer
        service: name=nginx state=started
  
  - hosts: webserver
    become: true
    tasks:
      - name: start webserver
        service: name=apache2 state=started